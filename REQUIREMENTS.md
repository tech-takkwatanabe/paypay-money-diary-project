# 要件定義書（PayPay 家計簿アプリ）

## 1. はじめに

### 1.1 プロジェクト名

PayPay Money Diary（仮）

### 1.2 目的

PayPay の取引履歴 CSV を取り込み、支出をカテゴリー別・月別・年別に可視化することで、ユーザーの家計管理をサポートする。

### 1.3 範囲

**対象範囲（In Scope）**

- PayPay 取引履歴 CSV の手動アップロード
- CSV データの解析・保存（バックエンドAPI経由）
- 月次レポート（円グラフ）
- 年次レポート（棒グラフ）
- カテゴリ編集機能

**対象外（Out of Scope）**

- PayPay API を使ったリアルタイムデータ取得（現時点では対象外）

---

## 2. ターゲットユーザー（ユーザーペルソナ）

- **主なユーザー**：PayPay を日常的に利用している一般ユーザー
- **ニーズ**：
  - 支出の内訳がひと目で分かること
  - 月・年単位の支出傾向を把握できること
  - 自分の使っている店舗に合わせたカテゴリ分けをしたい

---

## 3. 機能要件

### 3.1 データ取込（CSV インポート）

- [x] PayPay取引履歴CSVをアップロードできる
- [x] CSVフォーマットのバリデーション
- [x] CSVを解析し、日付・取引先・金額・カテゴリなどを抽出
  - **対象データ**: 「取引内容」が「支払い」の行のみを抽出（ポイント獲得などは除外）
  - **データ整形**: 金額フィールドのダブルクォート(`"`)とカンマ(`,`)を除去して数値化
  - **文字コード**: Shift-JIS / UTF-8 を自動判定して読み込み

### 3.2 ダッシュボード表示

- [x] 今月の支出合計、年間支出合計を表示
- [x] **月別カテゴリ円グラフ**を表示
- [x] **年間カテゴリ別棒グラフ（12ヶ月 × 1本ずつ）**
  - [x] 1本の棒にカテゴリ別の色分けスタック表示
  - [x] 月平均値も表示
- [x] 直近の取引リスト表示

### 3.3 支出一覧機能 (New) [x]

- [x] **支出一覧ページ**
  - [x] `expenses` テーブルのレコードを一覧表示
  - [x] 表示項目: 取引日 (`transaction_date`), 金額 (`amount`), 取引先 (`merchant`), カテゴリ (`category_id`)
  - [x] 年ごとの表示（ダッシュボードと連動）
  - [x] **検索機能**: 取引先 (`merchant`) での絞り込み表示
  - [x] **ソート機能**: 取引日、金額などでのソート（デフォルトは取引日降順）
  - [x] **カテゴリー編集機能**: 各レコードのカテゴリーを個別に変更可能

### 3.4 分析・レポート機能

- [x] 日付範囲での絞り込み
- [x] カテゴリ・店舗（取引先）でのフィルタ／ソート
- [ ] 「よく使う店舗ランキング」機能（Top Payees）

### 3.4 データ管理

- [x] データを PostgreSQL データベースに保存（Hono バックエンド経由）
- [ ] データリセット機能

### 3.5 カテゴリ管理

- [x] カテゴリの追加・編集・削除
- [x] 取引先に基づく自動カテゴリ推定（候補表示）
- [x] 取引単位でのカテゴリ修正
- [x] 取引先のパターン学習（徐々に精度向上）

---

## 4. 非機能要件

### 4.1 パフォーマンス

- チャート描画はデータ読み込み後 1 秒以内
- CSV 最大 10,000 行に対応

### 4.2 セキュリティ・プライバシー

- 個人情報は保持しない（取引データのみ）
- 適切な認証・認可を行い、ユーザーデータへのアクセスを制御する

### 4.3 ユーザビリティ

- PC/スマホどちらでも快適に操作できるレスポンシブUI
- CSVアップロード時のエラー表示を明瞭に

---

## 5. 画面・UX要件

- シンプルでミニマルな UI
- Tailwind CSS、Shadcn UI を活用（Next.jsベース）
- 視認性の高いチャートデザイン

---

## 6. 制約事項

- 対応ブラウザ：最新版 Chrome, Safari, Edge
- 技術スタック：Next.js、React、Tailwind CSS、Hono、Drizzle ORM、PostgreSQL

